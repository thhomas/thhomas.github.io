/*! ign-angular - v0.1.0 - 2016-02-10 */
!function(a,b){"use strict";b["true"]=a,angular.module("ign.angular.geocoder",["ui.bootstrap.typeahead"]).directive("geocoder",[function(){return{restrict:"AE",scope:{mapId:"@mapId",map:"=mapObject"},controller:"GeocoderController",template:'<input type="text" class="form-control" placeholder="Rechercher un lieu" uib-typeahead="poi.fulltext for poi in updatePoi($viewValue)" typeahead-on-select="moveToPoi($item, $model, $label)" ng-model="pointOfInterest">',link:{}}}]).controller("GeocoderController",["$attrs","$http","$scope",function(a,b,c){c.updatePoi=function(c){return b.jsonp(a.geocoderurl,{params:{text:c,type:"PositionOfInterest",callback:"JSON_CALLBACK"}}).then(function(a){var b=[];return angular.forEach(a.data.results,function(a){b.push(a)}),b})},c.moveToPoi=function(b){var c=this,d=c.$parent.getMap(a.mapId);d.moveTo(b.x,b.y,15)}}]),angular.module("ign.angular.layer",["ui.bootstrap","angularSpinner"]).factory("Layer",function(){function a(a){this.protocol=a.protocol,this.identifier=a.identifier,this.url=a.url,this.title=a.title,this.bbox=a.bbox,this.wmtsSourceOptions=a.wmtsSourceOptions,this.attributions=a.attributions,this.type="ORTHOIMAGERY"===this.identifier.split(".")[0]?"Photos":"GEOGRAPHICALGRIDSYSTEMS"===this.identifier.split(".")[0]?"Carte":"Autre"}return a.prototype.getUrl=function(){return this.url},a.prototype.getTitle=function(){return this.title},a.prototype.getType=function(){return this.type},a.prototype.getIdentifier=function(){return this.identifier},a.prototype.getExtent=function(){return this.bbox},a.prototype.getCenter=function(){return[(this.bbox[0]+this.bbox[2])/2,(this.bbox[1]+this.bbox[3])/2]},a.prototype.getWidth=function(){return this.bbox[2]-this.bbox[0]},a.prototype.getHeight=function(){return this.bbox[3]-this.bbox[1]},a.prototype.getTileMatrixSet=function(){return this.tileMatrixSet},a.prototype.getFormat=function(){return this.format},a.prototype.getStyle=function(){return this.style},a.prototype.getAttributions=function(){return this.attributions},a.prototype.createOlLayer=function(){return"WMTS"===this.protocol?(this.wmtsSourceOptions.crossOrigin="anonymous",this.olLayer=new ol.layer.Tile({title:this.title,useInterimTilesOnError:!0,source:new ol.source.WMTS(this.wmtsSourceOptions),maxResolution:2*this.wmtsSourceOptions.tileGrid.getResolution(this.wmtsSourceOptions.tileGrid.getMinZoom())})):"WMS"===this.protocol?this.olLayer=new ol.layer.Tile({title:this.title,extent:ol.proj.transformExtent(this.bbox,"EPSG:4326","EPSG:3857"),source:new ol.source.TileWMS({url:this.url,attributions:this.attributions,crossOrigin:"anonymous",params:{LAYERS:this.identifier,VERSION:"1.3.0",STYLE:this.style}})}):"osm"===this.identifier?this.olLayer=new ol.layer.Tile({title:this.title,source:new ol.source.OSM({attributions:[ol.source.OSM.ATTRIBUTION],crossOrigin:"http://openlayers.org",url:"http://b.tile.openstreetmap.org/{z}/{x}/{y}.png"})}):"bing"===this.identifier?this.olLayer=new ol.layer.Tile({title:this.title,preload:1/0,source:new ol.source.BingMaps({key:"Ak-dzM4wZjSqTlzveKz5u0d4IQ4bRzVI309GxmkgSVr1ewS6iPSrOvOKhA-CJlm3",imagerySet:"Aerial",maxZoom:19})}):"mapbox"===this.identifier?this.olLayer=new ol.layer.Tile({title:this.title,source:new ol.source.XYZ({url:"http://api.tiles.mapbox.com/v4/thhomas.mm528k4p/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoidGhob21hcyIsImEiOiJoS2tBb3lRIn0.Q76NgVSZUo4RO-F8HKIXOQ",crossOrigin:"anonymous",attributions:[new ol.Attribution({html:'<a href="https://www.mapbox.com/about/maps/" target="_blank">Maps &copy; Mapbox &copy;</a>'})]})}):"mapquest"===this.identifier?this.olLayer=new ol.layer.Tile({title:this.title,source:new ol.source.MapQuest({layer:"sat"})}):"google"===this.identifier&&(this.olLayer=new ol.layer.Tile({source:new ol.source.XYZ({title:this.title,url:"https://khms0.google.com/kh?v=175&hl=fr-FR&x={x}&y={y}&z={z}&token=124915",crossOrigin:"anonymous"})})),this.olLayer.set("ngLayer",this),this.olLayer},a.prototype.getOlLayer=function(){return null===this.olLayer&&this.createOlLayer(),this.olLayer},a}).factory("Capability",["Layer",function(a){function b(b,c){this.protocol=b,this.url="",this.layers=[];var d=[];"WMTS"===this.protocol?(this.url=c.OperationsMetadata.GetCapabilities.DCP.HTTP.Get[0].href,d=c.Contents.Layer):"WMS"===this.protocol?(this.url=c.Capability.Request.GetCapabilities.DCPType[0].HTTP.Get.OnlineResource,d=c.Capability.Layer.Layer):"WFS"===this.protocol?(this.url=c.WFS_Capabilities.OperationsMetadata.Operation[2].DCP.HTTP.Get.href,d=c.WFS_Capabilities.FeatureTypeList.FeatureType):"Static"===this.protocol&&(d=c.Contents.Layer),d.forEach(function(b){var d;if("WMTS"===this.protocol){var e=ol.source.WMTS.optionsFromCapabilities(c,{layer:b.Identifier,matrixSet:b.TileMatrixSetLink[0].TileMatrixSet});d=new a({protocol:this.protocol,url:this.url,identifier:b.Identifier,title:b.Title,bbox:b.WGS84BoundingBox,style:b.Style[0].Identifier,format:b.Format[0],wmtsSourceOptions:e})}else"WMS"===this.protocol?d=new a({protocol:this.protocol,url:this.url,identifier:b.Name,title:b.Title,bbox:void 0!==b.EX_GeographicBoundingBox?b.EX_GeographicBoundingBox:b.BoundingBox[0].extent,style:b.Style[0].Name,attributions:b.Attribution}):"WFS"===this.protocol||"Static"===this.protocol&&(d=new a({protocol:this.protocol,identifier:b.Identifier,title:b.Title,bbox:[-180,-90,180,90]}));this.layers.push(d)},this)}return b.prototype.getLayers=function(){return this.layers},b.prototype.getProtocol=function(){return this.protocol},b.prototype.getUrl=function(){return this.url},b}]),angular.module("ign.angular.layer").directive("layerCheckbox",[function(){return{restrict:"AE",scope:{mapId:"@mapId",index:"@index",wmtsUrl:"@wmtsUrl",wmsUrl:"@wmsUrl",wfsUrl:"@wfsUrl",staticLayer:"@staticLayer",layerName:"@layerName"},controller:"LayerCheckboxController",template:'<label class="checkbox"><input type="checkbox" ng-model="layerChecked" ng-change="onLayerCheck(layerChecked)">{{layer.Title}}</label>',link:{}}}]).controller("LayerCheckboxController",["$scope","LayerService","usSpinnerService",function(a,b,c){var d=a.$eval(a.wmtsUrl),e=a.$eval(a.wmsUrl),f=a.$eval(a.wfsUrl),g=a.$eval(a.staticLayer);a.capabilities=[],a.layersForCurrentExtent=[],void 0!==d&&b.getWMTSLayersFromCapabilities(d,a.capabilities).then(function(){a.$broadcast("layersLoadedFromCapabilities")}),void 0!==e&&b.getWMSLayersFromCapabilities(e,a.capabilities).then(function(){a.$broadcast("layersLoadedFromCapabilities")}),void 0!==g&&(b.getStaticLayerFromList(g,a.capabilities),a.$broadcast("layersLoadedFromCapabilities")),void 0!==f&&b.getWFSLayersFromUrl(f,a.capabilities).then(function(){a.$broadcast("layersLoadedFromCapabilities")}),a.$on("layersLoadedFromCapabilities",function(d){c.stop("layercheckbox"),void 0!==a.layerName&&(a.layer=b.getLayerByIdentifier(a.capabilities,a.layerName));var e=d.currentScope.map.getExtent();a.layersForCurrentExtent=b.getLayersForExtent(a.capabilities,ol.proj.transformExtent(e,"EPSG:3857","EPSG:4326")),void 0===a.layer&&(a.layer=a.layersForCurrentExtent[0]),a.$parent.$broadcast("layersLoaded",{})}),a.onLayerCheck=function(b){b?a.map.addLayer(a.layer):a.map.removeLayer(a.layer)}}]),angular.module("ign.angular.layer").directive("layerSelector",[function(){return{restrict:"AE",scope:{mapId:"@mapId",index:"@index",wmtsUrl:"@wmtsUrl",wmsUrl:"@wmsUrl",staticLayer:"@staticLayer"},controller:"LayerSelectorController",template:'<select class="form-control ign-layerselector" ng-options="layer.getTitle() group by layer.getType() for layer in layersForCurrentExtent" ng-model="layer" ng-change="onLayerChange(layer)"></select><span us-spinner="{radius:30, width:8, length: 16}" spinner-key="spinner-{{index}}" spinner-start-active="true"></span>',link:{}}}]).controller("LayerSelectorController",["$scope","$attrs","$parse","LayerService","usSpinnerService",function(a,b,c,d,e){var f="spinner-"+b.index,g=b.index;a.capabilities=[],a.layersForCurrentExtent=[];var h=b.mapId;void 0===h&&(h="mapDiv"),d.getWMTSLayersFromCapabilities(a.$eval(a.wmtsUrl),a.capabilities).then(function(){d.getWMSLayersFromCapabilities(a.$eval(a.wmsUrl),a.capabilities).then(function(){d.getStaticLayersFromList(a.$eval(a.staticLayer),a.capabilities),a.$broadcast("layersLoadedFromCapabilities")},a)},a),a.$on("layersLoadedFromCapabilities",function(){var b=a.$parent.getMap(h);e.stop(f);var c=b.getExtent();a.layersForCurrentExtent=d.getLayersForExtent(a.capabilities,ol.proj.transformExtent(c,"EPSG:3857","EPSG:4326")),a.layer=void 0!==a.$parent.layerIds&&void 0!==a.$parent.layerIds[g]?d.getLayerByIdentifier(a.capabilities,a.$parent.layerIds[g]):a.layersForCurrentExtent[0],a.initLayer(a.layer),a.$parent.$broadcast("layersLoaded",a.layer,g,h)}),a.$on("moveend",function(b,c,e,f){var g=a.$parent.getMap(f),h=g.getExtent();a.layersForCurrentExtent=d.getLayersForExtent(a.capabilities,ol.proj.transformExtent(h,"EPSG:3857","EPSG:4326")),a.$apply()}),a.initLayer=function(b){var c=a.$parent.getMap(h);c.addLayer(b,g),a.$parent.$broadcast("layerAdded",a.layer,g,h)},a.onLayerChange=function(b){var c=a.$parent.getMap(h);c.updateLayerAt(b,g);var d=b.getExtent(),e=ol.proj.transformExtent(c.getExtent(),"EPSG:3857","EPSG:4326");ol.extent.getWidth(d)<ol.extent.getWidth(e)&&ol.extent.getHeight(d)<ol.extent.getHeight(e)&&c.moveToExtent(ol.proj.transformExtent(d,"EPSG:4326","EPSG:3857")),a.$parent.$broadcast("layerChange",a.layer,g,h)}}]),angular.module("ign.angular.layer").service("LayerService",["$http","$q","Capability",function(a,b,c){var d=function(d,e){if(void 0===d)return b.when(e);var f=this;f.urls=[],angular.isArray(d)?f.urls=d:f.urls.push(d);for(var g=[],h=0;h<f.urls.length;h++)g[h]=a.get(f.urls[h]);return b.all(g).then(function(a){for(var b=new ol.format.WMTSCapabilities,d=0;d<a.length;d++)e.push(new c("WMTS",b.read(a[d].data)))})},e=function(d,e){if(void 0===d)return b.when(e);var f=this;f.urls=[],angular.isArray(d)?f.urls=d:f.urls.push(d);for(var g=[],h=0;h<f.urls.length;h++)g[h]=a.get(f.urls[h]);return b.all(g).then(function(a){for(var b=new ol.format.WMSCapabilities,d=0;d<a.length;d++)e.push(new c("WMS",b.read(a[d].data)))})},f=function(a,b){var c=this;c.urls=[],$.isArray(a)?c.urls=a:c.urls.push(a);for(var d=[],e=0;e<c.urls.length;e++)d[e]=$.ajax({url:c.urls[e],dataType:"xml"});return $.when.apply($,d).done(function(a){var c=$.xml2json(a.childNodes[0]);b.push({url:c["wfs:WFS_Capabilities"]["ows:OperationsMetadata"]["ows:Operation"][2]["ows:DCP"]["ows:HTTP"]["ows:Get"].$["xlink:href"],ogcType:"WFS",layers:c["wfs:WFS_Capabilities"].FeatureTypeList.FeatureType})})},g=function(a,b){var d=[];angular.forEach(a,function(a){"osm"===a?d.push({Identifier:"osm",Title:"OpenStreetMap"}):"bing"===a?d.push({Identifier:"bing",Title:"Bing Maps Aerial"}):"mapbox"===a?d.push({Identifier:"mapbox",Title:"MapBox Satellite"}):"mapquest"===a?d.push({Identifier:"mapquest",Title:"MapQuest Aerial"}):"google"===a&&d.push({Identifier:"google",Title:"GoogleMaps Earth"})}),d.length>0&&b.push(new c("Static",{Contents:{Layer:d}}))},h=function(a,b){var c=[],d=[(b[0]+b[2])/2,(b[1]+b[3])/2],e=b[2]-b[0],f=b[3]-b[1];return a.forEach(function(a){var b=a.getLayers();b.forEach(function(a){2*Math.abs(d[0]-a.getCenter()[0])<e+a.getWidth()&&2*Math.abs(d[1]-a.getCenter()[1])<f+a.getHeight()&&c.push(a)})}),c},i=function(a,b){var c;return a.forEach(function(a){a.getLayers().forEach(function(a){a.getIdentifier()===b&&(c=a)})}),c};return{getLayersForExtent:h,getLayerByIdentifier:i,getWMTSLayersFromCapabilities:d,getWMSLayersFromCapabilities:e,getWFSLayersFromUrl:f,getStaticLayersFromList:g}}]),angular.module("ign.angular.map",[]).factory("PermalinkControl",[function(){function a(a){var c=this,d=a||{},e=angular.element('<button id="permalinkButton" title="Permalien"><span class="glyphicon glyphicon-link"></span></button>'),f=angular.element('<div class="ol-permalink-menu navbar" style="visibility: hidden;"></div>'),g=angular.element('<ul class="nav navbar-nav"></ul>');g.append('<input class="ol-permalink-input">'),f.append(g);var h=angular.element('<div class="ol-permalink-control ol-unselectable ol-control"></div>');h.append(e),h.append(f),$(e).on("click",b),ol.control.Control.call(c,{element:h[0],target:d.target})}var b=function(){$(".ol-permalink-menu").css("visibility","hidden"===$(".ol-permalink-menu").css("visibility")?"visible":"hidden"),"visible"===$(".ol-permalink-menu").css("visibility")?$(".ol-permalink-button").addClass("ol-button-clicked"):$(".ol-permalink-button").removeClass("ol-button-clicked"),$(".ol-permalink-button").blur(),$(".ol-permalink-input").val(document.URL),$(".ol-permalink-input").select()};return ol.inherits(a,ol.control.Control),a}]).factory("MouseInfoControl",[function(){function a(a){var b=this,c=a||{},d=angular.element('<div id="'+a.id+'" class="ol-mouseinfo-control ol-unselectable ol-control"></div>');ol.control.Control.call(b,{element:d[0],target:c.target})}return ol.inherits(a,ol.control.Control),a.prototype.setMap=function(a){var b=this;if(ol.control.Control.prototype.setMap.call(this,a),a){var c=a.getViewport(),d=$(this.element);c.addEventListener("mousemove",function(){d.text(b.text)},this),c.addEventListener("mouseout",function(){d.text("")},this)}},a.prototype.setText=function(a){this.text=a},a}]).factory("GlobeControl",[function(){function a(a){var c=this,d=a||{},e=angular.element('<button id="globeButton" title="3D">3D</button>'),f=angular.element('<div class="ol-globe-control ol-unselectable ol-control" enabled="false"></div>');f.append(e),$(e).on("click",a.map,b),ol.control.Control.call(c,{element:f[0],target:d.target})}var b=function(a){var b=a.data,c=$(a.target),d=c.parent("div"),e=null;"false"===d.attr("enabled")?(d.attr("enabled","true"),e=!0):(d.attr("enabled","false"),e=!1),b.enable3d(e)};return ol.inherits(a,ol.control.Control),a}]).factory("DisplayControl",[function(){function a(a,c){var d=this,e=a||{},f=angular.element('<button id="scopeButton" class="ol-scope" title="Loupe"><span class="glyphicon glyphicon-search"></span></button>'),g=angular.element('<button id="verticalSliderButton" class="ol-display-group-control" title="Comparaison verticale"><span class="glyphicon glyphicon-resize-vertical"></span></button>'),h=angular.element('<button id="horizontalSliderButton" class="ol-display-group-control" title="Comparaison horizontale"><span class="glyphicon glyphicon-resize-horizontal"></span></button>'),i=angular.element('<button id="clipLayerButton" class="ol-clip-layer" title="Masquer"><span class="glyphicon glyphicon-eye-open"></span></button>'),j=angular.element('<button id="doubleMapButton" class="ol-double-map-control" title="Double affichage"><span class="glyphicon glyphicon-pause"></span></button>'),k=angular.element('<div class="ol-display-group-control ol-unselectable ol-control" mode=""></div>');k.append(f),k.append(g),k.append(h),k.append(i),k.append(j);var l=a.map;$(k).on("click",{map:l,scope:c},b),void 0!==a.firstLayerIndex&&void 0!==a.lastLayerIndex&&(k.attr("leftLayerIndex",a.firstLayerIndex),k.attr("rightLayerIndex",a.lastLayerIndex)),ol.control.Control.call(d,{element:k[0],target:e.target})}var b=function(a){var b=a.data.map,c=a.data.scope,d={};if($(a.target).is("button"))d=$(a.target).children("span");else{if(!$(a.target).is("span"))return;d=$(a.target)}var e=d.parents("div.ol-display-group-control"),f=$("#vertical-slider"),g=$("#horizontal-slider"),h="";d.hasClass("glyphicon-search")?(f.css("visibility","hidden"),g.css("visibility","hidden"),b.disableDoubleMap(),h="scope"):d.hasClass("glyphicon-resize-vertical")?("visible"!==f.css("visibility")?f.css("visibility","visible"):f.css("visibility","hidden"),g.css("visibility","hidden"),b.disableDoubleMap(),h="vSlider"):d.hasClass("glyphicon-resize-horizontal")?("visible"!==g.css("visibility")?g.css("visibility","visible"):g.css("visibility","hidden"),f.css("visibility","hidden"),b.disableDoubleMap(),h="hSlider"):d.hasClass("glyphicon-eye-open")?(f.css("visibility","hidden"),g.css("visibility","hidden"),b.disableDoubleMap(),h="clipLayer"):d.hasClass("glyphicon-pause")&&(f.css("visibility","hidden"),g.css("visibility","hidden"),void 0===b.getClonedMap()?b.enableDoubleMap(c):b.disableDoubleMap(),h="doubleMap"),e.children().removeClass("ol-button-clicked"),e.children().children(".glyphicon-eye-open").removeClass("glyphicon-eye-close"),b.getDisplayMode()!==h?(b.setDisplayMode(h),d.parent("button").addClass("ol-button-clicked"),d.hasClass("glyphicon-eye-open")&&d.addClass("glyphicon-eye-close")):(b.setDisplayMode(""),d.parent("button").blur()),b.enableWebGl($.inArray(b.getDisplayMode(),["hSlider","vSlider"])),b.clipTopLayer("clipLayer"===b.getDisplayMode()||"doubleMap"===b.getDisplayMode()),b.getOlMap().render()};return ol.inherits(a,ol.control.Control),a.prototype.initMode=function(a){var b=null;"scope"===a?b=this.element.childNodes.item(0):"vSlider"===a?b=this.element.childNodes.item(1):"hSlider"===a?b=this.element.childNodes.item(2):"clipLayer"===a?b=this.element.childNodes.item(3):"doubleMap"===a&&(b=this.element.childNodes.item(4)),b&&b.click()},a}]).factory("TuningControl",[function(){function a(a){var b=angular.element('<button title="Tuning"><span class="glyphicon glyphicon-chevron-down"></span></button>');$(b).on("click",a.map,d);var c=document.createElement("ul");c.className="ol-tuning-ul";var e=angular.element('<div class="ol-tuning-group-control ol-unselectable ol-control"></div>');e.append(b);var f=angular.element('<div class="ol-tuning-menu" style="visibility:hidden;"></div>');f.append(c),e.append(f),ol.control.Control.call(this,{element:e[0],target:a.target})}var b=function(a){var b=a.data.map,c=a.data.index,d=b.getOlMap().getLayers().getArray()[c];d.setOpacity(1),d.setBrightness(0),d.setContrast(1),d.setHue(0),d.setSaturation(1)},c=function(a){var b=a.data.map,c=a.data.index,d=b.getOlMap().getLayers().getArray()[c];a.target.id==="opacitySlider"+c?d.setOpacity(a.target.value):a.target.id==="brightnessSlider"+c?d.setBrightness(a.target.value):a.target.id==="contrastSlider"+c?d.setContrast(a.target.value):a.target.id==="hueSlider"+c?d.setHue(a.target.value):a.target.id==="saturationSlider"+c&&d.setSaturation(a.target.value)},d=function(a){var d=a.data,e=$(".ol-tuning-menu"),f=$(".ol-tuning-ul");if("visible"!==e.css("visibility")){$(f).empty();for(var g=0;g<d.getOlMap().getLayers().getArray().length;g++){var h=angular.element("<li></li>");h.append("<a>"+d.getOlMap().getLayers().getArray()[g].get("title")+"</a>");var i=angular.element('<button><span class="glyphicon glyphicon-repeat"></span></button>');$(i).on("click",{map:d,index:g},b),h.append(i);var j=angular.element('<div id="tuningSliders'+g+'"></div>');j.append("<label>Opacité</label>"),j.append('<input id="opacitySlider'+g+'" type="range" min="0" max="1" step="0.01" value="1">'),j.append("<label>Luminosité</label>"),j.append('<input id="brightnessSlider'+g+'" type="range" min="-1" max="1" step="0.01" value="0">'),j.append("<label>Contraste</label>"),j.append('<input id="contrastSlider'+g+'" type="range" min="0" max="2" step="0.01">'),j.append("<label>Teinte</label>"),j.append('<input id="hueSlider'+g+'" type="range" min="-3.141592653589793" max="3.141592653589793" step="0.01" value="0">'),j.append("<label>Saturation</label>"),j.append('<input id="saturationSlider'+g+'" type="range" min="0" max="5" step="0.01" value="1">'),$(j).on("input",{map:d,index:g},c),h.append(j),f.append(h)}}e.css("visibility","hidden"===$(".ol-tuning-menu").css("visibility")?"visible":"hidden")};return ol.inherits(a,ol.control.Control),a}]),angular.module("ign.angular.map").factory("map",["DisplayControl","TuningControl","PermalinkControl","GlobeControl","MouseInfoControl",function(a,b,c,d,e){function f(f,g,h){function i(){j.olMap.render()}var j=this,k=[267540.85,5873745.79],l=6;void 0!==g.center&&(k=ol.proj.transform(g.center,"EPSG:4326","EPSG:3857")),void 0!==g.zoom&&(l=g.zoom),j.renderer="canvas",void 0!==g.renderer&&(j.renderer=g.renderer);var m=ol.interaction.defaults();void 0!==g.interactions&&(m=ol.interaction.defaults(g.interactions)),j.mapId=g.mapId,void 0===j.mapId&&(j.mapId="mapDiv");var n=$(f.children()[0]),o=angular.element('<div id="'+j.mapId+'"></div>');n.append(o);var p=f.children()[1];ol.has.WEBGL||(j.renderer="canvas");var q=g.view;void 0===q&&(q=new ol.View({center:k,zoom:l,maxZoom:20})),j.olMap=new ol.Map({target:o[0],renderer:j.renderer,view:q,interactions:m,controls:[new ol.control.Zoom({zoomInTipLabel:"Zoom avant",zoomOutTipLabel:"Zoom arrière"}),new ol.control.Rotate,new ol.control.Attribution]}),$(".ol-viewport").css("float","left"),j.mousePosition=null;var r=[];if(null!==g&&angular.isObject(g)&&void 0!==g.controls&&angular.isArray(g.controls))for(var s=0;s<g.controls.length;s++)if("display"===g.controls[s]){var t=document.createElement("input");$(t).attr("id","vertical-input"),$(n).append(t);var u=$(t).slider({id:"vertical-slider",orientation:"vertical",handle:"square",min:0,value:50,max:100,step:.5,reversed:!0,tooltip:"hide"});$("#vertical-slider").css({visibility:"hidden","float":"left",position:"absolute",height:$(n).height()+"px","margin-left":"-15px"});var v=document.createElement("input");$(v).attr("id","horizontal-input"),$(p).append(v);var w=$(v).slider({id:"horizontal-slider",orientation:"horizontal",handle:"square",min:0,value:50,max:100,step:.5,tooltip:"hide"});$("#horizontal-slider").css({visibility:"hidden",width:$(n).width()+"px","margin-top":"-30px"}),w.on("slide",i),u.on("slide",i);var x=new a({firstLayerIndex:0,lastLayerIndex:1,map:j},h);r.push(x)}else if("tuning"===g.controls[s]){var y=new b({map:j},h);r.push(y)}else if("permalink"===g.controls[s]){var z=new c({map:j},h);r.push(z)}else if("3d"===g.controls[s]){var A=new d({map:j},h);r.push(A)}else"mousewheelzoom"===g.controls[s]&&j.olMap.addInteraction(new ol.interaction.MouseWheelZoom);r.push(new ol.control.MousePosition({projection:"EPSG:4326",coordinateFormat:ol.coordinate.createStringXY(4)}),new e({map:j,id:j.mapId+"-mouseInfoDiv"},h),new ol.control.ZoomToExtent({extent:[-667987.0760388413,5163825.976944365,1033145.0621032928,6664835.260509959],tipLabel:"Zoom France entière"}));for(var B=0;B<r.length;B++){var C=r[B];j.olMap.addControl(C)}j.mode=h.mode}return f.prototype={getOlMap:function(){return this.olMap},getClonedMap:function(){return this.olMap2},renderMap:function(){this.olMap.render()},getLayerByIdentifier:function(a){for(var b=0;b<this.olMap.getLayers().getLength();b++){var c=this.olMap.getLayers().item(b);if(c.get("identifier")===a)return c}return!1},getClonedLayerByIdentifier:function(a){if(void 0!==this.olMap2)for(var b=0;b<this.olMap2.getLayers().getLength();b++){var c=this.olMap2.getLayers().item(b);if(c.get("identifier")===a)return c}return!1},getExtent:function(){return this.olMap.getView().calculateExtent(this.olMap.getSize())},moveTo:function(a,b,c){var d=ol.proj.transform([a,b],"EPSG:4326","EPSG:3857");this.olMap.getView().setCenter(d),this.olMap.getView().setZoom(c)},moveToExtent:function(a){this.olMap.getView().fit(a,this.olMap.getSize())},clipTopLayer:function(a){this.olMap.getLayers().item(1).setVisible(!a)},addLayer:function(a){this.olMap.addLayer(a.createOlLayer()),"doubleMap"===this.getDisplayMode()&&this.olMap2.addLayer(a.createOlLayer())},updateLayerAt:function(a,b){if(angular.isString(b)&&(b=parseInt(b,10)),this.olMap.getLayers().setAt(b,a.createOlLayer()),"doubleMap"===this.getDisplayMode()){if(b>=1){var c=a.createOlLayer();this.olMap2.getLayers().setAt(0,c),this.olMap2.getLayers().setAt(0,c)}this.olMap.getLayers().item(1).setVisible(!1)}else b===this.olMap.getLayers().getLength()-1&&this.initWebGl(a.getOlLayer())},removeLayer:function(a){this.olMap.removeLayer(a.getOlLayer())},onprecompose:function(a){var b=this,c=a.frameState.pixelRatio,d=0,e=100,f=b.getDisplayMode();if("hSlider"===f?d=$("#horizontal-input").attr("value"):"vSlider"===f&&(e=$("#vertical-input").attr("value")),null!==a.context){var g=a.context;if(g.save(),g.beginPath(),"scope"!==f){var h=0,i=0;"hSlider"===f?h=g.canvas.width*(d/100):"vSlider"===f&&(i=g.canvas.height*(1-e/100)),g.rect(h,i,g.canvas.width-h,g.canvas.height-i)}else{var j=g.canvas.height/4;b.mousePosition&&(g.arc(b.mousePosition[0]*c,b.mousePosition[1]*c,j*c,0,2*Math.PI),g.lineWidth=0,g.strokeStyle="rgba(0,0,0,0)",g.stroke())}g.clip()}else if(null!==a.glContext){var k=a.glContext,l=k.getGL(),m=l.createProgram(),n=["precision mediump float;","void main() {","}"].join(""),o=["attribute vec2 a_position;","void main() {","  gl_Position = vec4(a_position, 0, 1);","}"].join(""),p=l.createShader(l.VERTEX_SHADER);l.shaderSource(p,o),l.compileShader(p),l.attachShader(m,p);var q=l.createShader(l.FRAGMENT_SHADER);l.shaderSource(q,n),l.compileShader(q),l.attachShader(m,q),l.linkProgram(m),k.useProgram(m);var r=l.getAttribLocation(m,"a_position");l.enable(l.STENCIL_TEST),l.colorMask(!1,!1,!1,!1),l.stencilOp(l.KEEP,l.KEEP,l.REPLACE),l.stencilFunc(l.ALWAYS,1,255);var s=l.createBuffer();if(l.bindBuffer(l.ARRAY_BUFFER,s),"scope"!==f)l.bufferData(l.ARRAY_BUFFER,new Float32Array([(d-50)/50,-1,(d-50)/50,(e-50)/50,1,(e-50)/50,(d-50)/50,-1,1,(e-50)/50,1,-1]),l.STATIC_DRAW),l.enableVertexAttribArray(r),l.vertexAttribPointer(r,2,l.FLOAT,!1,0,0),l.drawArrays(l.TRIANGLES,0,6);else if("scope"===f&&b.mousePosition){var t=new Float32Array(2);t[0]=2*b.mousePosition[0]/l.canvas.width-1,t[1]=1-2*b.mousePosition[1]/l.canvas.height;for(var u=new Float32Array(2160),v=0;2160>v;v+=6){var w=v/6;u[v]=t[0],u[v+1]=t[1],u[v+2]=t[0]+Math.cos(Math.PI*w/180)/(2*l.canvas.width/l.canvas.height),u[v+3]=t[1]+Math.sin(Math.PI*w/180)/2,u[v+4]=t[0]+Math.cos(Math.PI*(w+1)/180)/(2*l.canvas.width/l.canvas.height),u[v+5]=t[1]+Math.sin(Math.PI*(w+2)/180)/2}l.bufferData(l.ARRAY_BUFFER,u,l.STATIC_DRAW),l.enableVertexAttribArray(r),l.vertexAttribPointer(r,2,l.FLOAT,!1,0,0),l.drawArrays(l.TRIANGLES,0,1080)}l.bindBuffer(l.ARRAY_BUFFER,null),l.deleteBuffer(s),l.colorMask(!0,!0,!0,!0),l.stencilFunc(l.NOTEQUAL,0,255),l.stencilOp(l.KEEP,l.KEEP,l.KEEP)}},onpostcompose:function(a){if(null!==a.context){var b=a.context;b.restore()}else if(null!==a.glContext){var c=a.glContext,d=c.getGL();d.disable(d.STENCIL_TEST)}},enable3d:function(a){if(void 0===this.ol3d){this.ol3d=new olcs.OLCesium({map:this.olMap});var b=this.ol3d.getCesiumScene(),c="//assets.agi.com/stk-terrain/world",d=new Cesium.CesiumTerrainProvider({url:c,requestVertexNormals:!0});b.terrainProvider=d}this.ol3d.setEnabled(a)},enableWebGl:function(a){for(var b=0;b<this.olMap.getLayers().getLength();b++){var c=this.olMap.getLayers().item(b);a===!1?(c.un("precompose",this.onprecompose),c.un("postcompose",this.onpostcompose)):1===b&&this.initWebGl(c)}},initWebGl:function(a){a.on("precompose",this.onprecompose,this),a.on("postcompose",this.onpostcompose,this)},initDisplayControls:function(a){var b=this.getDisplayControl();b.initMode(a)},getDisplayControl:function(){var b=this.olMap.getControls(),c=null;return b.forEach(function(b){b instanceof a&&(c=b)}),c},displayMouseInfoControl:function(a,b){var c=this;if(b===c.mapId)var d=this.olMap.getControls();else if(b===c.mapId+"-cloned")var d=this.olMap2.getControls();d.forEach(function(b){b instanceof e&&(a===!0?$(b.element).show():$(b.element).hide())})},setMouseInfoControlText:function(a,b){var c=this;if(b===c.mapId)var d=this.olMap.getControls();else if(b===c.mapId+"-cloned")var d=this.olMap2.getControls();d.forEach(function(b){b instanceof e&&b.setText(a)})},getDisplayMode:function(){return this.mode},setDisplayMode:function(a){this.mode=a},getNgLayers:function(){var a=this,b=[];return a.getOlMap().getLayers().forEach(function(a){void 0!==a.get("ngLayer")&&b.push(a)}),b},getLayerVisibleUnderMouse:function(a){var b,c=this,d=[],e=a.map.getEventPixel(a.originalEvent);a.map.forEachLayerAtPixel(e,function(a){void 0!==a.get("ngLayer")&&d.push(a)},c),b=d[0];var f=c.getDisplayMode(),g=0,h=100;return"hSlider"===f?(g=$("#horizontal-input").attr("value"),e[0]<=c.getOlMap().getSize()[0]*g/100&&void 0!==d[0]&&d[0].get("ngLayer").getIdentifier()===c.getNgLayers()[1].get("ngLayer").getIdentifier()&&(b=d[1])):"vSlider"===f&&(h=$("#vertical-input").attr("value"),e[1]<=c.getOlMap().getSize()[1]*h/100&&void 0!==d[0]&&d[0].get("ngLayer").getIdentifier()===c.getNgLayers()[1].get("ngLayer").getIdentifier()&&(b=d[1])),b},addMarkerForDoubleMap:function(a){var b=this;a.map.getTarget().id===b.mapId?(b.olMap2.getOverlayById("marker2")||b.olMap2.addOverlay(b.marker2),b.marker2.setPosition(a.coordinate)):a.map.getTarget().id===b.mapId+"-cloned"&&(b.olMap.getOverlayById("marker")||b.olMap.addOverlay(b.marker),b.marker.setPosition(a.coordinate))},enableDoubleMap:function(a){var b=this,c=b.mapId;void 0===c&&(c="mapDiv");var d=$("#"+c+"Row"),f=angular.element('<div id="'+c+'-cloned" class="mapDouble"></div>'),g=$("#"+c);g.addClass("mapDouble"),d.append(f);var h=angular.element('<div id="marker" class="ign-marker"></div>'),i=angular.element('<div id="marker2" class="ign-marker"></div>');d.append(h),d.append(i);var j=[],k=b.getNgLayers();k.length<2&&alert("Oups, problème.");var l=k[1];l.setVisible(!1);var m=l.get("ngLayer"),n=m.createOlLayer();n.setVisible(!0),j.push(n);for(var o=2;o<k.length;o++)l=k[o],l.setVisible(!0),m=l.get("ngLayer"),n=m.createOlLayer(),m.getOlLayer().setVisible(!0),j.push(n);b.olMap2=new ol.Map({target:f[0],renderer:b.renderer,interactions:b.olMap.getInteractions(),view:b.olMap.getView(),layers:j,controls:[new ol.control.Zoom({zoomInTipLabel:"Zoom avant",zoomOutTipLabel:"Zoom arrière"}),new ol.control.Rotate,new ol.control.Attribution,new ol.control.MousePosition({projection:"EPSG:4326",coordinateFormat:ol.coordinate.createStringXY(4)}),new e({map:b,id:b.mapId+"-cloned-mouseInfoDiv"})]}),b.marker2=new ol.Overlay({id:"marker2",position:b.olMap.getView().getCenter(),positioning:"center-center",element:$("#marker2")[0]}),b.marker=new ol.Overlay({id:"marker",position:b.olMap.getView().getCenter(),positioning:"center-center",element:$("#marker")[0]}),b.olMap.on("pointermove",b.addMarkerForDoubleMap,b),b.olMap2.on("pointermove",b.addMarkerForDoubleMap,b),b.olMap2.on("pointermove",function(b){var c=this;a.$broadcast("pointermove",c,b,c.mapId+"-cloned")},b),$(d).mouseout(function(){b.olMap.removeOverlay(b.olMap.getOverlayById("marker")),b.olMap2.removeOverlay(b.olMap2.getOverlayById("marker2"))}),$(f).css({height:g.height()+"px"}),b.olMap.updateSize(),b.olMap2.updateSize()},disableDoubleMap:function(){var a=this,b=a.mapId;void 0===b&&(b="mapDiv");var c=$("#"+b),d=$("#"+b+"Row");c.removeClass("mapDouble"),void 0!==a.olMap2&&(a.olMap2.setTarget(null),a.olMap2=void 0),a.olMap.un("pointermove",a.addMarkerForDoubleMap,a),$(d).off("mouseout"),$("#"+b+"-cloned").remove(),$("#marker").remove(),$("#marker2").remove();var e=a.olMap.getLayers().item(1);e.setVisible(!0),a.olMap.updateSize()},enableMouseInfo:function(a){var b=this;b.mousePosition=b.olMap.getEventPixel(a.originalEvent),b.olMap.render()}},f}]).directive("olMap",["Layer","map","$rootScope",function(a,b,c){return{restrict:"AE",scope:!1,controller:"OlMapController",link:{pre:function(a,d,e){function f(a){var b=$(d).height(),c=$(d).width();$(d[0]).find("#"+a).css({height:b+"px"}),void 0!==$(d[0]).find("#"+a+"-cloned")&&$(d[0]).find("#"+a+"-cloned").css({height:b+"px"}),setTimeout(function(){b=p.olMap.getSize()[1],c=p.olMap.getSize()[0],"doubleMap"===p.getDisplayMode()&&(c+=p.getClonedMap().getSize()[0]),$(d[0]).find("#vertical-slider").css({height:b+"px"}),$(d[0]).find("#horizontal-slider").css({width:c+"px"})},500),p.olMap.updateSize()}var g={},h=[],i=[];void 0!==e.controls&&angular.isArray(c.$eval(e.controls))===!0&&e.controls.length>0&&(h=c.$eval(e.controls)),void 0!==e.interactions&&angular.isObject(c.$eval(e.interactions))===!0&&(i=c.$eval(e.interactions));var j="mapDiv";void 0!==e.mapId&&null!==e.mapId&&(j=e.mapId);var k,l,m;void 0!==a.center&&null!==a.center?k=a.center:void 0!==e.center&&null!==e.center&&(k=c.$eval(e.center)),void 0!==a.zoom&&null!==a.zoom?l=a.zoom:void 0!==e.zoom&&null!==e.zoom&&(l=c.$eval(e.zoom)),void 0!==a.renderer&&null!==a.renderer?m=a.renderer:void 0!==e.renderer&&null!==e.renderer&&(m=c.$eval(e.renderer));
var n=angular.element('<div class="row" id="'+j+'Row"></div>'),o=angular.element('<div class="row" id="'+j+'SliderRow"></div>');d.append(n),d.append(o),void 0===a.map&&(a.map=[]);var p=new b(d,{mapId:e.mapId,center:k,zoom:l,renderer:m,controls:h,interactions:i,options:g},a);a.map.push(p),p.olMap.on("moveend",function(b){var c=this;a.$broadcast("moveend",c,b,j)}),p.olMap.on("pointermove",function(b){var c=this;a.$broadcast("pointermove",c,b,j)},p),p.olMap.on("pointermove",p.enableMouseInfo,p),a.$broadcast("mapready",j),$(window).resize(function(){f(j)}),f(j)}}}}]).controller("OlMapController",["$scope",function(a){a.getMap=function(b){var c;return void 0===b&&(b="mapDiv"),a.map.forEach(function(a){a.mapId===b&&(c=a)}),c},a.$on("layerAdded",function(b,c,d,e){var f=a.getMap(e),d=d;angular.isString(d)&&(d=parseInt(d,10));var g=f.getOlMap().getLayers().getArray();if(g.length>1){var h;f.getOlMap().getLayers().getArray().forEach(function(a,b){a.get("ngLayer").getIdentifier()===c.getIdentifier()&&(h=b)}),g[d].get("ngLayer").getIdentifier()!==c.getIdentifier()&&(f.getOlMap().getLayers().removeAt(h),f.getOlMap().getLayers().insertAt(d,c.olLayer))}})}])}({},function(){return this}());
//# sourceMappingURL=ign-angular.map